<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
<script src="javascript/layout.js " type="text/javascript"></script>
<script src="javascript/tSNE.js " type="text/javascript"></script>
<script src="javascript/hexBin.js " type="text/javascript"></script>
<script src="deps/graph-scroll/graph-scroll.js " type="text/javascript"></script>

<head>
  <link rel="stylesheet" href="css/intro.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/conclusion.css">
  <link rel="stylesheet" href="css/tSNE.css">
  <link href="https://fonts.googleapis.com/css?family=Old+Standard+TT" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet">
</head>

<body>
  
  <!-- Intro Begins -->
  <div id="intro_container"> 
    <div id="intro">
      <h1>Movie Night</h1>
      <div id="intro_text">
        <span>
          In this visualization, we explore the ties of time with movie popularity and characteristics to find a relationship
          between what makes a movie successful, and how our taste changes through time can influence the movies that are considered well-done. 
          As we travel through each decade, play close attention to which movies are considered similar to each other, the top
          three keywords for each decade, the top rated movies, and the way the clusters of data form. 
          Enjoy the show!
        </span>
      </div>
    </div>
    <div id="start">
      <div id="position_arrows">
        <i class="left_down"></i>
        <i class="right_down"></i>
      </div>
    </div> 
  </div>

  <!-- Year Overlay -->
  <div id="container">
    <div id="year_container" class="stickme">
      <div id="top"> 
        <div id="year">
          <span>1880-1950</span>
        </div>
        <div id="middle">
          <svg id="mainVis" width="100%" height="100%"></svg>
        </div>
        <div id="right">
          <h1>Top Keywords</h1>
          <div id="keywordSummaryContainer">
            <ol id="keywordSummary"></ol>
          </div>
          <div id="buttons">
            <input class="button-item" id="searchbox" type="text" placeholder="Search..."  onkeydown="search(this)"/>
            <button class="button-item" id="next_decade">Next Decade</button>
            <button class="button-item" onclick="goToConclusion()">Conclusion</button>
          </div>
        </div>
      </div>
      <div id="footer" class="stickme">
          <div class="progress" id="p1"></div>
          <div class="progress" id="p2"></div>
          <div class="progress" id="p3"></div>
        </div>
    </div>
    <!-- Wall of Text (no, literally...) -->
    <div id="narration">
      <div class="statement">
        <p>
            Let’s orient you to the visualization. The current years of movies you are looking at appears right above this narration 
            (a ‘bin’). As you scroll the page, the bin will change and we’ll talk a little bit about what’s going on right here.
             You can monitor your progress through the current bin with the progress bar at the bottom.
            On the far right is a running list of top keywords movies had within the bins up to and including
             the currently viewed one - this can help you get a sense of how themes change with time. 
             If you wish to quickly advance, there’s also some convenience buttons at the bottom. Finally,
              use the search box to help you find specific keywords, studios, movies, directors, or actors on the soon-to-be-displayed chart.            
        </p>
      </div>
      <div class="statement" id="graph1950">
        <p> In the center of the page is a visualization made with t-SNE clustering. t-SNE (t-Distributed Stochastic Neighbor Embedding)
         is an algorithm used to reduce dimensionality in a  high-dimensional dataset. T-SNE allows us to create this three dimensional
         visualization form a multi-dimensional dataset.
        </p>
        <p>Each bubble in the visualization represents a movie that was released in the current decade. N features were extracted from these movies (ie. Director, genera, and runtime) and these features were used by t-SNE to cluster similar movies together.
           Our visualization is a three dimensional t-SNE, the first two dimensions being X and Y locations and the third color. 
        </p>
      </div>
      <div class="statement">
         <p>
            If you hover over a movie you can view information about the movie including it’s title,
             genera, and runtime. As you hover over the visualization you can begin to use the tooltips and
            keywords to notice patterns among the clusters and similarities among the movies, you may even find some Disney movies in the mix.
         </p>
         <p>
            The Horse in Motion was created in 1878 this was a motion photography created by taking a bunch of simultaneous pictures. Roundhay Garden Scene was then created in 1888 this was only 2.1 seconds long but is still classified as a movie. The third movie ever created was Arrival of a Train in 1895 this movie shows a train being pulled into a station. 
            If you type “Arrival” you will be able to find where this movie is located in the visualization.
            <!-- Potentially do the search for them -->
         </p>
      </div>
      <div class="statement">
        <p>
            In the beginning movies were only black and white and primarily silent films. 
            Before there was sound in films musicians sat below the screen and would play music along with the movie.
            The first move with sound was the The Jazz Singer made in 1927. While some movies before 1950 had sound it was 
            not popular until the 50s. Search “silent film” while in this decade and then again when you move onto the 50s and see how movies changed.
        </p>
      </div>
      <div class="statement" id="graph1960">
        <p>
          t-SNE has clustered the data on three axis X, Y and Z. The X and Y axis appear as they would on a normal
           graph but the Z axis is represented by the color. The Z axis is portrayed by color in order to make a 3 
           dimensional graph a 2 dimensional graph, you can picture for example that in a 3D graph all of the green points
            would be in the same spot on the Z axis.
          </p>
      </div>
      <div class="statement">
        <p>
          World War (Closing of World War II)
        </p>
      </div>
      <div class="statement">
        c
      </div>
      <div class="statement" id="graph1970">
        <p>
          Because this visualization is a 3D graph flattened into a 2D graph the physical distance between movies does not indicate anything 
          about the two movies. Just because the two highlighted clusters of movies are on opposite sides of the visualization does not mean 
          these two clusters are that they are extremely different from each other.
        </p>
      </div>
      <div class="statement">
        <p>
            Spaghetti Western, also known as Italian Western or Macaroni Western
            are western movie that emerged in the mid of the 1960's due to Sergio Leone's
            success in the film industry. As seen in the top keywords, it's the top
            keyword for this year. 
        </p>
      </div>
      <div class="statement">
        <p>
          However, after performing a search on the term, you can observe that most of
          them did not have good rankings or seem to cluster together. 
          These movies tended to have a style that allowed for low budgets in Europe
          and American Genres were rapidly changing. The Western started evolving from 
          here until a rougher form, and some critics believe Sergio Leone influenced it.
        </p>
      </div>
      <div class="statement" id="graph1980">
        <p>
          Cluster of locations (the ones with Star Wars)
        </p>
      </div>
      <div class="statement">
        f
      </div>
      <div class="statement">
        g
      </div>
      <div class="statement" id="graph1990">
        <p>
          Space and Cold War
        </p>
      </div>
      <div class="statement">
        i
      </div>
      <div class="statement">
        j
      </div>
      <div class="statement" id="graph2000">
        <p>
          Size affected by Rating Cluster of popular Upper Right green thingy
          (pointer thingy here)
        </p>
      </div>
      <div class="statement">
        l
      </div>
      <div class="statement">
        m
      </div>
      <div class="statement" id="graph2010">
        <p>
          In the 2000's, one of the most influencial series of this generation was introduced as a movie.
          Harry Potter is a series of fantasy novels that began as a novel
          published in 1997. Warner Bro's produced the first Harry Potter movie in November 2001.  
        </p>
      </div>
      <div class="statement">
        <p>
          As you notice when you search "Harry Potter", you can see that four of the Harry Potter
          movies were clusterd together: Harry Potter and the Sorcerer's Stone, The Prisioner of Azkaban,
          The Chamber of Secrets, and The Goblet of Fire. On the other cluster, is the Half-Blood Prince
          the Order of the Phoenix.
        </p>
      </div>
      <div class="statement">
        <p>
         This powerful novel created not only an escape of reality to a magical world, but created
         a movement filled with fans. The success of the novels led to a website called
         Pottermore being created in which you can find yourself in a journey
         through the story with more access that was not revealed in the books and
         allowing fans to be in a wizardry land.
        </p>
      </div>
      <div class="statement" id="graph2020">
        <p>
          From animated movies to science fiction, heroes have been rising in the past
          decade as depicted by the Top Keywords. With the rise of cutting-edge special effects,
          the spectacular scenes that allow to escape your own world, and fans of the comic-books,
          it is no surprise that super heroes movies have become increasingly popular.
        </p>
      </div>
      <div class="statement">
        <p>
          However, there may be a more discrete reasoning behind the rise of super hero movies.
          Dark events in U.S. history such as 9/11 and the House Market Crash could have influenced
          the population towards hero movies. Although they were popular beforehand,
          the reality of the situation could have pushed people towards the sense
          of comfort that super heroes can bring.
        </p>
      </div>
      <div class="statement">
          <p>
            Finally, the rise of computers and special effects, have added layers of
            excitement as movies have become more realistic and believable. The growth in
            technology in the past years has been exponential, and leaves us curious for the future
            of the cinema.
          </p>
      </div>
    </div>
  </div>

  <!-- Conclusion begins -->
  <div id="conclusion_container"> 
    <div id="summary-text"> 
      <h1>Conclusion</h1>
      ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
      Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
      Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
    Citations:
    https://en.wikipedia.org/wiki/Sergio_Leone
    https://en.wikipedia.org/wiki/Spaghetti_Western
    https://en.wikipedia.org/wiki/Harry_Potter
    https://www.nyfa.edu/student-resources/the-rise-of-superhero-films/
    http://highschool.latimes.com/orange-county-school-of-the-arts/post-911-world-what-caused-the-rise-of-superhero-movies/  
  </div>
    <div class="summary-container">
      <div class="summary-item" onclick="returnToDecade(1950)">
        <svg id="summ-1950" width="100%" height="100%"></svg>
        <div class="year">1880-1950</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1960)">
        <svg id="summ-1960" width="100%" height="100%"></svg>
        <div class="year">1950-1960</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1970)">
        <svg id="summ-1970" width="100%" height="100%"></svg>
        <div class="year">1960-1970</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1980)">
        <svg id="summ-1980" width="100%" height="100%"></svg>
        <div class="year">1970-1980</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1990)">
        <svg id="summ-1990" width="100%" height="100%"></svg>
        <div class="year">1980-1990</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2000)">
        <svg id="summ-2000" width="100%" height="100%"></svg>
        <div class="year">1990-2000</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2010)">
        <svg id="summ-2010" width="100%" height="100%"></svg>
        <div class="year">2000-2010</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2020)">
        <svg id="summ-2020" width="100%" height="100%"></svg>
        <div class="year">2010-2020</div>
      </div>
    </div>
  </div>
</body>

<script>
  // Globals
  let SCROLLINGTO = null;
  let DOMAIN = 'http://localhost:8000/'
  let dispatch = d3.dispatch('decade-update', 'point-to', 'stop-force', 'filter')

  // Keywords list:
  let keywords;
  let keywordSummary;

  // Prep the scrolly
  d3.graphScroll()
    .graph(d3.selectAll('.stickme'))
    .container(d3.select('#container'))
    .sections(d3.selectAll('.statement, #conclusion_container'))
    .on('active', function(i) {
      let active_id = d3.select(`.graph-scroll-active`).attr('id');

      // If at the conclusion, stop all forces and prepare to jump.
      if(active_id === 'conclusion_container'){
        dispatch.call('stop-force', null)
        SCROLLINGTO = null
        return
      }

      // Fill progress bar
      if(i > 0){
        setProgress(i)
      }else{
        d3.selectAll('.progress-made').classed('progress-made', false)
      }

      // Check if decade has changed. (Changes every 3, starting @ 1)
      if(i > 0 && (i-1)%3 == 0){
        let decade = 1950 + (i-1)/3 * 10;
        let prevDecade = ((i-1)/3) === 0 ? 1880 : 1950 + (((i-1)/3)-1) * 10
        d3.select('#year').html(`${prevDecade} - ${decade}`);
        
        // Determine if target bin hit, then send updates (else skip).
        if(active_id === SCROLLINGTO){
          SCROLLINGTO = null
        }
        if(SCROLLINGTO === null){
          transitionDecade(decade, keywords)
        }
      }

      // Dispatch pointer events (clear old ones)
      d3.selectAll('.story-pointer').remove()
      if(i === 3){
        dispatch.call('point-to', this, {points: [{x: 100, y: 100, r: 20}], classed:"story-pointer"})
      }
    })

  // Build the TSNE chart, nothing will draw until dispatch
  buildTSNE(d3.select('#mainVis'))
 
  // Build conclusions
  let bins = [1950,1960,1970,1980,1990,2000,2010,2020]
  bins.map(b => {
    d3.queue()
      .defer(d3.json, `${DOMAIN}data/final/tSNE/coords/${b}.json`)
      .defer(d3.json, `${DOMAIN}data/final/tSNE/colors/${b}.json`)
      .awaitAll(function(err, res){
        if(err) { console.error(err); return }
        buildHex(d3.select(`#summ-${b}`), res[0], res[1])
      })
  })

  // Build the keyword summary list
  d3.json(`${DOMAIN}data/final/topkeywords.json`, (err, data) => {
    if(err) { console.error(err); return }
    keywords = data;
  })

  function search(ele) {
    if(event.key === 'Enter') {
      let term = ele.value.toLowerCase();
      if(term === ""){
        // Clear the filter
        dispatch.call('filter', null, null)
      }else{
        // Set the filter
        dispatch.call('filter', null, term)
      }
    }
  }
</script>
