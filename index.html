<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
<script src="javascript/tSNE.js " type="text/javascript"></script>
<script src="javascript/hexBin.js " type="text/javascript"></script>
<script src="deps/graph-scroll/graph-scroll.js " type="text/javascript"></script>

<head>
  <link rel="stylesheet" href="css/intro.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/conclusion.css">
  <link rel="stylesheet" href="css/tSNE.css">
  <link href="https://fonts.googleapis.com/css?family=Old+Standard+TT" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet">
</head>

<body>
  
  <!-- Intro Begins -->
  <div id="intro_container"> 
    <div id="intro">
      <h1>Movie Night</h1>
      <div id="intro_text">
        <span>
          In this visualization, we explore the ties of time with movie popularity and characteristics to find a relationship
          between what makes a movie successful, and how our taste changes through time can influence the movies that are considered well-done. 
          As we travel through each decade, play close attention to which movies are considered similar to each other, the top
          three keywords for each decade, the top rated movies, and the way the clusters of data form. 
          Enjoy the show!
        </span>
      </div>
    </div>
    <div id="start">
      <div id="position_arrows">
        <i class="left_down"></i>
        <i class="right_down"></i>
      </div>
    </div> 
  </div>

  <!-- Year Overlay -->
  <div id="container">
    <div id="year_container" class="stickme">
      <div id="top"> 
        <div id="year">
          <span>1950</span>
        </div>
        <div id="middle">
          <svg id="mainVis" width="100%" height="100%"></svg>
        </div>
        <div id="right">
          <h1>Top Keywords</h1>
          <div id="keywords">
            <ol> 
              <li>keyword one</li>
              <li>keyword two</li>
              <li>keyword three</li>
            </ol>
          </div>
          <div id="buttons">
            <button class="button-item" id="next_decade">Next Decade</button>
            <button class="button-item" onclick="goToConclusion()">Conclusion</button>
          </div>
        </div>
      </div>
      <div id="footer" class="stickme">
          <div class="progress"></div>
          <div class="progress"></div>
          <div class="progress"></div>
        </div>
    </div>
    <!-- Wall of Text (no, literally...) -->
    <div id="narration">
      <div class="statement"></div>
      <div class="statement" id="graph1950">
        This is an awesome statement about why the world should look into being better people. Did you know most people are not better people? I know better people.
      </div>
      <div class="statement">
          STAHP. Wait a minute ;)
      </div>
      <div class="statement">
          meow. Wait a minute ;)
      </div>
      <div class="statement" id="graph1960">
        a
      </div>
      <div class="statement">
        b
      </div>
      <div class="statement">
        c
      </div>
      <div class="statement" id="graph1970">
        d
      </div>
      <div class="statement">
        e
      </div>
      <div class="statement">
        f
      </div>
      <div class="statement" id="graph1980">
        e
      </div>
      <div class="statement">
        f
      </div>
      <div class="statement">
        g
      </div>
      <div class="statement" id="graph1990">
        h
      </div>
      <div class="statement">
        i
      </div>
      <div class="statement">
        j
      </div>
      <div class="statement" id="graph2000">
        k
      </div>
      <div class="statement">
        l
      </div>
      <div class="statement">
        m
      </div>
      <div class="statement" id="graph2010">
        n
      </div>
      <div class="statement">
        n
      </div>
      <div class="statement">
        o
      </div>
      <div class="statement" id="graph2020">
        p
      </div>
      <div class="statement">
        q
      </div>
      <div class="statement">
          q
      </div>
    </div>
  </div>

  <!-- Conclusion begins -->
  <div id="conclusion_container"> 
    <div id="summary-text"> 
      <h1>Conclusion</h1>
      ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
      Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
      Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
    </div>
    <div class="summary-container">
      <div class="summary-item" onclick="returnToDecade(1950)">
        <svg id="summ-1950" width="100%" height="100%"></svg>
        <div class="year">1950</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1960)">
        <svg id="summ-1960" width="100%" height="100%"></svg>
        <div class="year">1960</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1970)">
        <svg id="summ-1970" width="100%" height="100%"></svg>
        <div class="year">1970</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1980)">
        <svg id="summ-1980" width="100%" height="100%"></svg>
        <div class="year">1980</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(1990)">
        <svg id="summ-1990" width="100%" height="100%"></svg>
        <div class="year">1990</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2000)">
        <svg id="summ-2000" width="100%" height="100%"></svg>
        <div class="year">2000</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2010)">
        <svg id="summ-2010" width="100%" height="100%"></svg>
        <div class="year">2010</div>
      </div>
      <div class="summary-item" onclick="returnToDecade(2020)">
        <svg id="summ-2020" width="100%" height="100%"></svg>
        <div class="year">2020</div>
      </div>
    </div>
  </div>
</body>

<script>
  // Globals
  let SCROLLINGTO = null;
  let DOMAIN = 'http://localhost:8000/'
  let dispatch = d3.dispatch('decade-update', 'point-to', 'stop-force')

  // Prep the scrolly
  d3.graphScroll()
    .graph(d3.selectAll('.stickme'))
    .container(d3.select('#container'))
    .sections(d3.selectAll('.statement'))
    .on('active', function(i) {
      // Check if decade has changed. (Changes every 3, starting @ 1)
      if(i > 0 && (i-1)%3 == 0){
        let decade = 1950 + (i-1)/3 * 10;

        // Check what is currently in view. If its the scrollingto decade, set
        // scrollingto to null, send dispatches, and update listeners.
        if(d3.select(`.graph-scroll-active`).attr('id') === SCROLLINGTO){
          SCROLLINGTO = null
        }
        if(SCROLLINGTO === null){
          document.getElementById("next_decade").removeEventListener("click", fastForwardDecade);
          document.getElementById("next_decade").addEventListener("click", () => fastForwardDecade(decade));
          dispatch.call('stop-force', this, decade)
          dispatch.call('decade-update', this, decade)
        }
      }

      // Dispatch pointer events (clear old ones)
      d3.selectAll('.pointer').remove()
      if(i === 3){
        dispatch.call('point-to', this, [{x: 100, y: 100, r: 20}])
      }
    })

  // Build the TSNE chart, nothing will draw until dispatch
  buildTSNE(d3.select('#mainVis'))
 
  // Build conclusions
  let bins = [1950,1960,1970,1980,1990,2000,2010,2020]
  let queue = bins.reduce((acc, b) => acc.defer(d3.json, `${DOMAIN}tSNE/coords/${b}.json`), d3.queue())
  queue.awaitAll(function(err, responses){
    if(err) { console.error(err); return }
    responses.map((d,i) => { buildHex(d3.select(`#summ-${bins[i]}`), d) })
  })

  // Will jump forward to the given decade when triggered.
  function fastForwardDecade(decade) {
    dispatch.call('stop-force', this, decade)
    SCROLLINGTO = decade == 2020 ? 'conclusion_container' : 'graph' + (decade+10);
    document.querySelector('#' + SCROLLINGTO).scrollIntoView({ 
      behavior: 'smooth' 
    });
  }

  // Will return to a decade earlier on the page when triggered
  function returnToDecade(decade){
    SCROLLINGTO = 'graph' + decade
    document.querySelector('#'+SCROLLINGTO).scrollIntoView({ 
      behavior: 'smooth' 
    });
  }

  // Will jump to conclusion
  function goToConclusion() {
    dispatch.call('stop-force', this, decade)
    SCROLLINGTO = 'conclusion_container'
    document.querySelector('#'+SCROLLINGTO).scrollIntoView({ 
      behavior: 'smooth' 
    });
  }
</script>
